#!/bin/bash
# Install the Neovim Nightly from source
# REQUIRES: 007-apt-update
#
# NOTE: This installs the source rather than the PPA (ppa:neovim-ppa/unstable)
#	as that seems not to actually be a Nightly build
#       - MC 2021-06-16

source common

init apt-install --lazy --header "Install Pre-requisites" \
	autoconf \
	automake \
	cmake \
	g++ \
	gettext \
	libtool \
	libtool-bin \
	ninja-build \
	pkg-config \
	python3 \
	python3-pip \
	unzip \


init status "Install Python module"
init pip-install neovim

init source-clone neovim https://github.com/neovim/neovim.git

init status "Clearing build state"
make distclean

init status "Building Neovim"
make CMAKE_BUILD_TYPE=RelWithDebInfo

init status "Installing Neovim"
sudo make install

init status "Set alternate linking for vi / vim / editor"
NVIM=`which nvim`
sudo update-alternatives --install /usr/bin/vi vi $NVIM 60
# sudo update-alternatives --config vi
sudo update-alternatives --install /usr/bin/vim vim $NVIM 60
# sudo update-alternatives --config vim
sudo update-alternatives --install /usr/bin/editor editor $NVIM 60
# sudo update-alternatives --config editor


if [ -e "$HOME/.vim/setup" ]; then
	init status "Update MC Nvim config"
	cd ~/.vim
	git pull
	$HOME/.vim/setup
else
	init status "Setup MC Nvim config"
	cd
	git clone https://github.com/hash-bang/vimrc.git .vim
	ln -s "$HOME/.vim" "$HOME/.config/nvim"
	$HOME/.vim/setup
fi
